<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started • tidyposterior</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../tidyverse-2.css" rel="stylesheet">
<!--optional theme--><link href="../../tidymodels.css" rel="stylesheet">
<meta property="og:title" content="Getting Started">
<meta property="og:description" content="tidyposterior">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../../index.html">tidyposterior</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of <a href="https://tidymodels.org">tidymodels</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.0.3.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../articles/articles/Getting_Started.html">Getting Started</a>
</li>
<li>
  <a href="../../articles/Different_Bayesian_Models.html">Different Bayesian Models</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/tidyposterior/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Getting_Started_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/tidyposterior/blob/master/vignettes/articles/Getting_Started.Rmd"><code>vignettes/articles/Getting_Started.Rmd</code></a></small>
      <div class="hidden name"><code>Getting_Started.Rmd</code></div>

    </div>

    
    
<p>To show how <code>tidyposterior</code> compares models, let’s look at a small data set. The <code>modeldata</code> package has a data set called <code>two_class_dat</code> that has 791 data points on to predictors. The outcome is a two-level factor. There is some linear-ish separation between the classes but hints that a nonlinear class boundary might do slightly better.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyposterior.tidymodels.org">tidyposterior</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">two_class_dat</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">two_class_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">A</span>, y <span class="op">=</span> <span class="va">B</span>, col <span class="op">=</span> <span class="va">Class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_Started_files/figure-html/class-plot-1.png" width="768" style="display: block; margin: auto;"></p>
<p><code>tidyposterior</code> models performance statistics produced by models, such as RMSE, accuracy, or the area under the ROC curve. It relies on resampling to produce replicates of these performance statistics so that they can be modeled.</p>
<p>We’ll use simple 10-fold cross-validation here. Any other resampling method from <code>rsample</code>, except a simple validation set, would also be appropriate.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">cv_folds</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">two_class_dat</span><span class="op">)</span>
<span class="va">cv_folds</span></code></pre></div>
<pre><code>## #  10-fold cross-validation 
## # A tibble: 10 x 2
##    splits           id    
##    &lt;list&gt;           &lt;chr&gt; 
##  1 &lt;split [711/80]&gt; Fold01
##  2 &lt;split [712/79]&gt; Fold02
##  3 &lt;split [712/79]&gt; Fold03
##  4 &lt;split [712/79]&gt; Fold04
##  5 &lt;split [712/79]&gt; Fold05
##  6 &lt;split [712/79]&gt; Fold06
##  7 &lt;split [712/79]&gt; Fold07
##  8 &lt;split [712/79]&gt; Fold08
##  9 &lt;split [712/79]&gt; Fold09
## 10 &lt;split [712/79]&gt; Fold10</code></pre>
<p>We’ll use a logistic regression model for these data and initially consider two different preprocessing methods that might help the fit. Let’s define a model specification:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">logistic_spec</span> <span class="op">&lt;-</span> <span class="fu">logistic_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glm"</span><span class="op">)</span></code></pre></div>
<div id="comparing-modelingprepreocessing-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-modelingprepreocessing-methods" class="anchor"></a>Comparing modeling/prepreocessing methods</h2>
<p>One way to incorporate nonlinearity into the class boundary is to use a spline basis expansion for the predictors. A <code>recipe</code> step using <code>step_ns</code> will will encode the predictors in this way. The degrees of freedom will be hard-coded to produce two additional feature columns per predictor:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spline_rec</span> <span class="op">&lt;-</span> 
  <span class="fu">recipe</span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">two_class_dat</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">step_ns</span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, deg_free <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="va">spline_wflow</span> <span class="op">&lt;-</span> 
  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">spline_rec</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_model</span><span class="op">(</span><span class="va">logistic_spec</span><span class="op">)</span></code></pre></div>
<p>Binding the model and recipe into a workflow creates a simple interface when we <code>fit()</code> and <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> the data (but isn’t required by <code>tidypredict</code>).</p>
<p>An alternate preprocessing method is to normalize the data using a spatial sign transformation. This projects the predictors on to a unit circle and can sometimes mitigate the effect of collinearity or outliers. A recipe is also used. Here is a visual representation of the data after the transformation:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spatial_sign_rec</span> <span class="op">&lt;-</span> 
  <span class="fu">recipe</span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">two_class_dat</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">step_normalize</span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">step_spatialsign</span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span><span class="op">)</span>

<span class="va">spatial_sign_rec</span> <span class="op">%&gt;%</span> 
  <span class="fu">prep</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">bake</span><span class="op">(</span>new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">A</span>, y <span class="op">=</span> <span class="va">B</span>, col <span class="op">=</span> <span class="va">Class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_Started_files/figure-html/class-plot-spatial-sign-1.png" width="768" style="display: block; margin: auto;"> Another workflow is created for this method:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spatial_sign_wflow</span> <span class="op">&lt;-</span> 
  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">spatial_sign_rec</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_model</span><span class="op">(</span><span class="va">logistic_spec</span><span class="op">)</span></code></pre></div>
<p><code>tidyposterior</code> does not require the user to create their models using tidymodels packages, <code>caret</code>, or any other method (although there are advantages to using those tools). In the end a data frame format with resample identifiers and columns for performance statistics are needed.</p>
<p>To produce this format with our tidymodels objects, this small convenience function will create a model on the 90% of the data allocated by cross-validation, predict the other 10%, then calculate the area under the ROC curve. If you use tidymodels, there are high-level interfaces (shown below) that don’t require such a function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">compute_roc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">split</span>, <span class="va">wflow</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Fit the model to 90% of the data</span>
  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">wflow</span>, data <span class="op">=</span> <span class="fu">analysis</span><span class="op">(</span><span class="va">split</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># Predict the other 10%</span>
  <span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, new_data <span class="op">=</span> <span class="fu">assessment</span><span class="op">(</span><span class="va">split</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span>
  <span class="co"># Compute the area under the ROC curve</span>
  <span class="va">pred</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="fu">assessment</span><span class="op">(</span><span class="va">split</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">roc_auc</span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_Class1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">.estimate</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>For our <code>rsample</code> object <code>cv_folds</code>, let’s create two columns of ROC statistics using this function in conjunction with <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roc_values</span> <span class="op">&lt;-</span> 
  <span class="va">cv_folds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    spatial_sign <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">splits</span>, <span class="va">compute_roc</span>, <span class="va">spatial_sign_wflow</span><span class="op">)</span>,
    splines      <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">splits</span>, <span class="va">compute_roc</span>, <span class="va">spline_wflow</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">roc_values</span></code></pre></div>
<pre><code>## #  10-fold cross-validation 
## # A tibble: 10 x 4
##    splits           id     spatial_sign splines
##    &lt;list&gt;           &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;
##  1 &lt;split [711/80]&gt; Fold01        0.943   0.946
##  2 &lt;split [712/79]&gt; Fold02        0.861   0.852
##  3 &lt;split [712/79]&gt; Fold03        0.819   0.838
##  4 &lt;split [712/79]&gt; Fold04        0.844   0.873
##  5 &lt;split [712/79]&gt; Fold05        0.865   0.902
##  6 &lt;split [712/79]&gt; Fold06        0.868   0.909
##  7 &lt;split [712/79]&gt; Fold07        0.952   0.934
##  8 &lt;split [712/79]&gt; Fold08        0.904   0.920
##  9 &lt;split [712/79]&gt; Fold09        0.765   0.811
## 10 &lt;split [712/79]&gt; Fold10        0.851   0.889</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Overall ROC statistics per workflow:</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>
  <span class="va">roc_values</span>,
  splines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span>,
  spatial_sign <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">spatial_sign</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   splines spatial_sign
##     &lt;dbl&gt;        &lt;dbl&gt;
## 1   0.887        0.867</code></pre>
<p>There is the suggestion that using splines is better than the spatial sign. It would be nice to have some inferential analysis that could tell us if the size of this difference is create than the experimental noise in the data.</p>
<p><code>tidyposterior</code> uses a Bayesian ANOVA model to compute posterior distributions for the performance statistic of each modeling method. This tells use the probabilistic distribution of the model performance metrics and allows us to make more formal statements about the superiority (or equivalence) of different models. <a href=""><em>Tidy Models with R</em></a> has a good explanation of how the Bayesian ANOVA model works.</p>
<p>The main function to conduct the analysis is <code><a href="../../reference/perf_mod.html">perf_mod()</a></code>. The main argument is for the object containing the resampling information and at least two numeric columns of performance statistics (measuring the same metric). As described in <code><a href="../../reference/perf_mod.html">?perf_mod</a></code>, there are a variety of other object types that can be used for this argument.</p>
<p>There are also options for statistical parameters of the analysis, such as any transformation of the output statistics that should be used and so on.</p>
<p>The main options in our analysis are passed through to the <code>rstanarm</code> function <code>stan_glmer()</code>. These include:</p>
<ul>
<li><p><code>seed</code>: An integer that controls the random numbers used in the Bayesian model.</p></li>
<li><p><code>iter</code>: The total number of Montre Carlo iterations used (including the burn-in samples).</p></li>
<li><p><code>chains</code>: The number of independent Markov Chain Monte Carlo analyses to compute.</p></li>
<li><p><code>refresh</code>: How often to update the log (a value of zero means no output).</p></li>
</ul>
<p>Other options that can be helpful (but we’ll use their defaults):</p>
<ul>
<li><p><code>prior_intercept</code>: The main argument in this analysis for specifying the prior distribution of the parameters.</p></li>
<li><p><code>family</code>: The exponential family distribution for the performance statistics.</p></li>
<li><p><code>cores</code>: The number of parallel workers to use to speed-up computations.</p></li>
</ul>
<p>Our call to this function is:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rset_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/perf_mod.html">perf_mod</a></span><span class="op">(</span><span class="va">roc_values</span>, seed <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">5000</span>, chains <span class="op">=</span> <span class="fl">5</span>, refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: There were 1 divergent transitions after warmup. See
## http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
## to find out why this is a problem and how to eliminate them.</code></pre>
<pre><code>## Warning: Examine the pairs() plot to diagnose sampling problems</code></pre>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function for this type of object shows the output from <code>stan_glmer()</code>. It’s long, so we show some of the initial output:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">rset_mod</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Model Info:
##  function:     stan_glmer
##  family:       gaussian [identity]
##  formula:      statistic ~ model + (1 | id)
##  algorithm:    sampling
##  sample:       12500 (posterior sample size)
##  priors:       see help('prior_summary')
##  observations: 20
##  groups:       id (10)
## 
## Estimates:
##                                     mean   sd     10%    50%    90% 
## (Intercept)                        0.867  0.016  0.847  0.867  0.887
## modelsplines                       0.020  0.009  0.009  0.020  0.031
## b[(Intercept) id:Fold01]           0.060  0.020  0.034  0.060  0.085
## 
## &lt;snip&gt;</code></pre>
<p>Assuming that our assumptions are appropriate, one of the main things that we’d like to get out of the object are samples of the posterior distributions for the performance metrics (per modeling method). The <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> method will produce a data frame with such samples:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">rset_mod</span>, seed <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## # Posterior samples of performance
## # A tibble: 25,000 x 2
##    model        posterior
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 spatial_sign     0.866
##  2 spatial_sign     0.864
##  3 spatial_sign     0.863
##  4 spatial_sign     0.870
##  5 spatial_sign     0.863
##  6 spatial_sign     0.880
##  7 spatial_sign     0.874
##  8 spatial_sign     0.876
##  9 spatial_sign     0.873
## 10 spatial_sign     0.876
## # … with 24,990 more rows</code></pre>
<p>We require a <code>seed</code> value since it is a sample.</p>
<p>There is a simple plotting method for the object too:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">rset_mod</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_Started_files/figure-html/preproc-bayes-plot-1.png" width="768" style="display: block; margin: auto;"></p>
<p>There is some overlap but, again, it would be better if we could quantify this.</p>
<p>To compare models, the <code><a href="../../reference/contrast_models.html">contrast_models()</a></code> function computes the posterior distributions of differences in performance statistics between models. For example, what does the posterior look like for the difference in performance for these two preprocessing methods? By default, the function computes all possible differences (a single contrast for this example). There are also <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> and plot methods:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">preproc_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/contrast_models.html">contrast_models</a></span><span class="op">(</span><span class="va">rset_mod</span>, seed <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">preproc_diff</span>, seed <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##   contrast      probability    mean   lower    upper  size pract_neg pract_equiv
##   &lt;chr&gt;               &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
## 1 spatial_sign…      0.0174 -0.0201 -0.0351 -0.00535     0        NA          NA
## # … with 1 more variable: pract_pos &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">preproc_diff</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Difference in ROC (spatial sign - splines)"</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_Started_files/figure-html/preproc-contrast-1.png" width="768" style="display: block; margin: auto;"> Since the difference is negative, the spline model appears better than the spatial sign method. The summary output quantifies this by producing a simple credible interval for the difference. The probability column also reflects this since it is the probability that the spline ROC scores are greater than the analogous statistics from the spatial sign model. A value of 0.5 would indicate no difference.</p>
<p>There is an additional analysis that can be used. The ROPE method, short for <em>Region of Practical Equivalence</em>, is a method for understanding the differences in models in less subjective way. For this analysis, we would specify a practical effect size (usually before the analysis). This quantity reflects what difference in the metric is considered practically meaning full in the context of our problem. In our example, if we saw two models with a difference in their ROC statistics of 0.02, we might consider them effectually different (your beliefs may differ).</p>
<p>Once we have settled on a value of this effect size (in the units of the statistic), we can compute how much of the difference is within this region of practical equivalence (in our example, this is <code>[-0.02, 0.02]</code>). If the difference is mostly within these bounds, the models might be significantly different but not practically different. Alternatively, if the differences are beyond this, they would be different in both senses.</p>
<p>The summary and plot methods have optional arguments called <code>size.</code> The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function computes the probability of the posterior differences that fall inside and outside of this region. The plot method shows it visually:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">preproc_diff</span>, size <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">contrast</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"pract"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   contrast                pract_neg pract_equiv pract_pos
##   &lt;chr&gt;                       &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;
## 1 spatial_sign vs splines     0.504       0.495    0.0004</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">preproc_diff</span>, size <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_Started_files/figure-html/preproc-rope-1.png" width="768" style="display: block; margin: auto;"></p>
<p>For this analysis, there are about even odds that the difference between these models is not practically important (since the <code>pract_equiv</code> is near 0.5).</p>
<div id="about-our-assumptions" class="section level3">
<h3 class="hasAnchor">
<a href="#about-our-assumptions" class="anchor"></a>About our assumptions</h3>
<p>Previously, the expression “assuming that our assumptions are appropriate” was used. This is an inferential analysis and the validity of our assumptions matter a great deal. There are a few assumptions for this analysis. The main one is that we’ve specified the outcome distribution well. We’ve models the area under the ROC curve. This is a statistic bounded (effectively) between 0.5 and 1.0. The variance of the statistic is probably related to the mean; there is likely less variation in scores near 1.0 than those near 0.5.</p>
<p>The default family for <code>stan_glmer()</code> is Gaussian. Given the characteristics of this metric, that assumption might seem problematic.</p>
<p>However, Gaussian seems like a good first approach for this assumption. The rationale is based on the Central Limit Theorem. As the sample size increases, the sample mean statistic converges to normality despite the distribution of the individual data points. Our performance estimates are summary statistics and, if the training set size is “large enough”, they will exhibit behavior consistent with normality.</p>
<p>As a simple (and approximate) example/diagnostics, suppose we used a simple ANOVA for the ROC statistics using <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>. This is not the same analysis as the one used by <code>tidyposterior</code>, but the regression parameter estimates should be fairly similar. For that analysis, we can assess the normality of the residuals and see that they are pretty consistent with the normality assumption:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roc_longer</span> <span class="op">&lt;-</span> 
  <span class="va">roc_values</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">splits</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"preprocessor"</span>, values_to <span class="op">=</span> <span class="st">"roc"</span><span class="op">)</span>

<span class="va">roc_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">roc</span> <span class="op">~</span> <span class="va">preprocessor</span>, <span class="va">roc_longer</span><span class="op">)</span>

<span class="va">roc_fit</span> <span class="op">%&gt;%</span> 
  <span class="fu">augment</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">geom_qq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">geom_qq_line</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio  <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_Started_files/figure-html/roc_dist-1.png" width="768" style="display: block; margin: auto;"></p>
<p>If this were not the case there are a few things that we can do.</p>
<p>The easiest approach would be to use a variance stabilizing transformation of the metrics and keep the Gaussian assumption. <code><a href="../../reference/perf_mod.html">perf_mod()</a></code> has a <code>transform</code> argument that will transform the outcome but still produce the posterior distributions in the original units. This will help if the variation within each model significantly changes over the range of the values. When transformed back to the original units, the posteriors will have different variances.</p>
<p>Another option that can help with heterogeneous variances is <code>hetero_var.</code> This fits a difference variance for each modeling method. However, this may make convergence of the model more difficult.</p>
<p>Finally, a different distribution can be assumed using the family argument to <code>stan_glmer()</code>. Since our metrics are numeric, there are not many families to choose from.</p>
</div>
</div>
<div id="evaluating-sub-models" class="section level2">
<h2 class="hasAnchor">
<a href="#evaluating-sub-models" class="anchor"></a>Evaluating sub-models</h2>
<p>The previous example was a between-model comparison (where “model” really means statistical model plus preprocessing method). If the model must be tuned, there is also the issue of within-model comparisons.</p>
<p>For our spline analysis, we assumed that three degrees of freedom were appropriate. However, we might tune the model over that parameter to see what the best degrees of freedom should be.</p>
<p>The previous spline recipe is altered so that the degrees of freedom parameter doesn’t have an actual value. Instead, using a value of <code>tune()</code> will mark this parameter for optimization. There are a few different approaches for tuning this parameter; we’ll use simpe grid search.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spline_rec</span> <span class="op">&lt;-</span> 
  <span class="fu">recipe</span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">two_class_dat</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">step_ns</span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, deg_free <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The <code>tune</code> package function <code><a href="https://tune.tidymodels.org/reference/tune_grid.html">tune_grid()</a></code> is used to evaluate several values of the parameter. For each value, the resampled area under the ROC curve is computed.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spline_tune</span> <span class="op">&lt;-</span>
  <span class="va">logistic_spec</span> <span class="op">%&gt;%</span>
  <span class="fu">tune_grid</span><span class="op">(</span>
    <span class="va">spline_rec</span>,
    resamples <span class="op">=</span> <span class="va">cv_folds</span>,
    grid <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>deg_free <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,
    metrics <span class="op">=</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">roc_auc</span><span class="op">)</span>,
    control <span class="op">=</span> <span class="fu">control_grid</span><span class="op">(</span>save_workflow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">)</span>
<span class="fu">collect_metrics</span><span class="op">(</span><span class="va">spline_tune</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 7
##   deg_free .metric .estimator  mean     n std_err .config             
##      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
## 1        1 roc_auc binary     0.888    10  0.0141 Preprocessor1_Model1
## 2        3 roc_auc binary     0.887    10  0.0137 Preprocessor2_Model1
## 3        5 roc_auc binary     0.886    10  0.0133 Preprocessor3_Model1
## 4       10 roc_auc binary     0.883    10  0.0128 Preprocessor4_Model1</code></pre>
<p>There is a <code><a href="../../reference/perf_mod.html">perf_mod()</a></code> method for this type of object. The computations are conducted in the same manner but, in this instance, four sub-models are compared.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/perf_mod.html">perf_mod</a></span><span class="op">(</span><span class="va">spline_tune</span>, seed <span class="op">=</span> <span class="fl">6</span>, iter <span class="op">=</span> <span class="fl">5000</span>, chains <span class="op">=</span> <span class="fl">5</span>, refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">grid_mod</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_Started_files/figure-html/tune-grid-bayes-1.png" width="768" style="display: block; margin: auto;"></p>
<p>When the object given to perf_mod is from a model tuning function, the <code>model</code> column corresponds to the <code>.config</code> column in the results.</p>
<p>There is a lot of overlap. The results do call into question the overall utility of using splines. A single degree of freedom model corresponds to a linear effect. Let’s compare the linear class boundaries to the other sub-models to see if splines are even improving the model.</p>
<p>The contrast_model function can take two lists of model identifiers and compute their differences. Again, for tuning objects, this should include values of <code>.config</code>. This specification compute the difference <code>{1 df - X df}</code> so positive differences indicate that the linear model is better.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid_diff</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../../reference/contrast_models.html">contrast_models</a></span><span class="op">(</span>
    <span class="va">grid_mod</span>,
    list_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Preprocessor1_Model1"</span>, <span class="fl">3</span><span class="op">)</span>,
    list_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
      <span class="st">"Preprocessor2_Model1"</span>, <span class="co"># &lt;-  3 df spline</span>
      <span class="st">"Preprocessor3_Model1"</span>, <span class="co"># &lt;-  5 df spline</span>
      <span class="st">"Preprocessor4_Model1"</span>  <span class="co"># &lt;- 10 df spline</span>
    <span class="op">)</span>,
    seed <span class="op">=</span> <span class="fl">7</span>
  <span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">grid_diff</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 9
##   contrast      probability    mean    lower   upper  size pract_neg pract_equiv
##   &lt;chr&gt;               &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
## 1 Preprocessor…       0.530 2.78e-4 -0.00596 0.00641     0        NA          NA
## 2 Preprocessor…       0.629 1.17e-3 -0.00492 0.00719     0        NA          NA
## 3 Preprocessor…       0.894 4.47e-3 -0.00155 0.0105      0        NA          NA
## # … with 1 more variable: pract_pos &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">grid_diff</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_Started_files/figure-html/tune-grid-bayes-contrast-plot-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The results indicate that a lot of degrees of freedom might make the model worse. At best, there is a limited difference in performance when more than one spline term is used.</p>
<p>The ROPE analysis is more definitive; there is no sense of practical differences within the previously used effect size:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">grid_diff</span>, size <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_Started_files/figure-html/tune-grid-rope-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="workflow-sets" class="section level2">
<h2 class="hasAnchor">
<a href="#workflow-sets" class="anchor"></a>Workflow sets</h2>
<p>Workflow sets are collections of workflows and their results. These can be made after existing workflows have been evaluated or by using <code><a href="https://workflowsets.tidymodels.org/reference/workflow_set.html">workflow_set()</a></code> to create an evaluate the models.</p>
<p>Let’s create an initial set that has difference combinations of the two predictors for this data set.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflowsets">workflowsets</a></span><span class="op">)</span>

<span class="va">logistic_set</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://workflowsets.tidymodels.org/reference/workflow_set.html">workflow_set</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">Class</span> <span class="op">~</span> <span class="va">A</span>, B <span class="op">=</span> <span class="va">Class</span> <span class="op">~</span> <span class="va">B</span>, ratio <span class="op">=</span> <span class="va">Class</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">A</span><span class="op">/</span><span class="va">B</span><span class="op">)</span><span class="op">)</span>, 
         spatial_sign <span class="op">=</span> <span class="va">spatial_sign_rec</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>logistic <span class="op">=</span> <span class="va">logistic_spec</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">logistic_set</span></code></pre></div>
<pre><code>## # A workflow set/tibble: 4 x 4
##   wflow_id              info             option    result    
##   &lt;chr&gt;                 &lt;list&gt;           &lt;list&gt;    &lt;list&gt;    
## 1 A_logistic            &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;
## 2 B_logistic            &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;
## 3 ratio_logistic        &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;
## 4 spatial_sign_logistic &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;</code></pre>
<p>The <code>object</code> volumn contains the workflows that are created by the combinations of preprocessors and the model (multiple models could have been used). Rather than calling the same functions from the <code>tune</code> package repeatedly, we can evaluate these with a single function call. Notice that none of these workflows require tuning so <code><a href="https://tune.tidymodels.org/reference/fit_resamples.html">tune::fit_resamples()</a></code> can be used:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">logistic_res</span> <span class="op">&lt;-</span> 
  <span class="va">logistic_set</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://workflowsets.tidymodels.org/reference/workflow_map.html">workflow_map</a></span><span class="op">(</span><span class="st">"fit_resamples"</span>, seed <span class="op">=</span> <span class="fl">3</span>, resamples <span class="op">=</span> <span class="va">cv_folds</span>, 
               metrics <span class="op">=</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">roc_auc</span><span class="op">)</span><span class="op">)</span> 
<span class="va">logistic_res</span></code></pre></div>
<pre><code>## # A workflow set/tibble: 4 x 4
##   wflow_id              info             option    result   
##   &lt;chr&gt;                 &lt;list&gt;           &lt;list&gt;    &lt;list&gt;   
## 1 A_logistic            &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;
## 2 B_logistic            &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;
## 3 ratio_logistic        &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;
## 4 spatial_sign_logistic &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html">collect_metrics</a></span><span class="op">(</span><span class="va">logistic_res</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"roc_auc"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 9
##   wflow_id     .config     preproc model  .metric .estimator  mean     n std_err
##   &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1 A_logistic   Preprocess… formula logis… roc_auc binary     0.702    10  0.0210
## 2 B_logistic   Preprocess… formula logis… roc_auc binary     0.866    10  0.0151
## 3 ratio_logis… Preprocess… formula logis… roc_auc binary     0.749    10  0.0164
## 4 spatial_sig… Preprocess… recipe  logis… roc_auc binary     0.867    10  0.0176</code></pre>
<p>We can also add the previously tuned spline results by first converting them to a workflow set then appending their rows to the results:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">logistic_res</span> <span class="op">&lt;-</span> 
  <span class="va">logistic_res</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>
    <span class="fu"><a href="https://workflowsets.tidymodels.org/reference/as_workflow_set.html">as_workflow_set</a></span><span class="op">(</span>splines <span class="op">=</span> <span class="va">spline_tune</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">logistic_res</span></code></pre></div>
<pre><code>## # A workflow set/tibble: 5 x 4
##   wflow_id              info             option    result   
##   &lt;chr&gt;                 &lt;list&gt;           &lt;list&gt;    &lt;list&gt;   
## 1 A_logistic            &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;
## 2 B_logistic            &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;
## 3 ratio_logistic        &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;
## 4 spatial_sign_logistic &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;
## 5 splines               &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;tune[+]&gt;</code></pre>
<p>There are some convenience functions to take an initial look at the results:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://workflowsets.tidymodels.org/reference/rank_results.html">rank_results</a></span><span class="op">(</span><span class="va">logistic_res</span>, rank_metric <span class="op">=</span> <span class="st">"roc_auc"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"roc_auc"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 8 x 9
##   wflow_id     .config     .metric  mean std_err     n preprocessor model   rank
##   &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;int&gt;
## 1 splines      Preprocess… roc_auc 0.888  0.0141    10 recipe       logis…     1
## 2 splines      Preprocess… roc_auc 0.887  0.0137    10 recipe       logis…     2
## 3 splines      Preprocess… roc_auc 0.886  0.0133    10 recipe       logis…     3
## 4 splines      Preprocess… roc_auc 0.883  0.0128    10 recipe       logis…     4
## 5 spatial_sig… Preprocess… roc_auc 0.867  0.0176    10 recipe       logis…     5
## 6 B_logistic   Preprocess… roc_auc 0.866  0.0151    10 formula      logis…     6
## 7 ratio_logis… Preprocess… roc_auc 0.749  0.0164    10 formula      logis…     7
## 8 A_logistic   Preprocess… roc_auc 0.702  0.0210    10 formula      logis…     8</code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">logistic_res</span>, metric <span class="op">=</span> <span class="st">"roc_auc"</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_Started_files/figure-html/wflow-res-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The <code><a href="../../reference/perf_mod.html">perf_mod()</a></code> method for workflow sets takes the best submodel from each workflow and then uses the standard <code>tidyposterior</code> analysis:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roc_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/perf_mod.html">perf_mod</a></span><span class="op">(</span><span class="va">logistic_res</span>, metric <span class="op">=</span> <span class="st">"roc_auc"</span>, seed <span class="op">=</span> <span class="fl">1</span>, refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>The results of this call produces an object with an additional class to enable some <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> methods specific to workflow sets. For example, the default plot shows 90% credible intervals for the best results in each workflow:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">roc_mod</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_Started_files/figure-html/wflow-intervals-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Alternatively, the ROPE estimates for a given since can be computed to compare the numerically best workflow to the others. The probability of practical equivalence is shown for all results:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">roc_mod</span>, type <span class="op">=</span> <span class="st">"ROPE"</span>, size <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_Started_files/figure-html/wflow-rope-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="tidyverse">
  <p>tidyposterior is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
